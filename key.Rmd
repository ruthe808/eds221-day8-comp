---
title: "Data Visualization"
author: "Ruth Enriquez"
date: "2022-08-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(here)
library(janitor)

library(patchwork)
library(ggrepel)
library(gghighlight)
library(paletteer)
library(ggExtra)
library(ggbeeswarm)

library(gapminder)

library(sf)
```

### Read in the lizard data

```{r}
lizards <- read_csv(here("data_tidy", "lizards.csv"))
```

###Make a heatmap - added on day 10 move to another file

```{r}
lizard_counts <- lizards |> 
  mutate(date = lubridate::mdy(date)) |> 
  count(year = lubridate::year(date), common_name) |> 
  drop_na()
```

```{r}
ggplot(data = lizard_counts, aes(x = year,
                                 y = common_name)) +
  geom_tile(aes(fill = n), show.legend = FALSE) +
  geom_text(aes(label = n), color = "white", size = 3) +
  scale_fill_gradientn(colors = c("navy", "red", "orange")) +
  theme_minimal()
```

###Beeswarm Plot- added on day 10 move to another file

```{r}
whiptails <- lizards |> 
  filter(common_name == "western whiptail") |> 
  drop_na(total_length, weight)
```

```{r}
whiptail_bee <- ggplot(data = whiptails, aes(x = sex,
                             y = weight)) +
  geom_beeswarm() +
  geom_boxplot(fill = NA)
```

### Marginal plot

- starting from whiptails, plot total length (x-axis) versus weight (y-axis), with point color dependent on sex.

```{r}
whiptail_plot <- ggplot(data = whiptails, aes(x = total_length,
                             y = weight)) +
  geom_point(aes(color = sex)) +
  theme(legend.position = "bottom")

ggMarginal(whiptail_plot, type = "boxplot", groupColour = TRUE)
```

### Patchwork - compound figures

```{r}
((whiptail_bee + whiptail_plot) / whiptail_bee) & theme_dark()

#+ will put stuff side by side (columns), / creates things in rows, & will be applied to all of your plots
```

```{r}
ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point()

#you can also write this ggplot(data = lizards) + geom_point(aes(x = total_length, y = weight))
```

Create a histogram of total lengths for all lizards in the dataset.

```{r}
ggplot(data = lizards, aes (x = total_length)) +
  geom_histogram(color = "orange",
                 fill = "purple",
                 size = 0.3,
                 linetype = "dotted")
```

```{r}
ggplot(data = lizards, aes(x = total_length, y = weight))+
  geom_point(
    shape = 25,
    color = "cyan4",
    fill = "yellow",
    size = 4,
    alpha = 0.4
  )
```

```{r}
ggplot(data = lizards, 
       aes(x = total_length, 
           y = weight))+
  geom_point(aes(color = common_name,
                 size = total_length),
             alpha = 0.5) +
  theme_dark()
```


```{r}
ggplot(data = lizards, 
       aes(x = total_length, 
           y = weight))+
  geom_point() +
  facet_wrap(~common_name, scales = "free")
```

##reordering

```{r}
lizard_counts <- lizards |> 
  group_by(common_name) |> 
  summarize(
    counts = n()
  )

#count - n(): will return number of rows that show up

lizard_counts2 <- lizards |> 
  count(common_name, site, tail)
```

bar plot/column graph that plots value n

```{r}
ggplot(data = lizard_counts, 
       aes(y= fct_reorder(common_name, counts), 
           x = counts)) +
  geom_col()
```

Create a scatterplots, faceted by species, for total length versus weight. The color and shape of points should differ based on the species (common name). Change the theme. Make each faceted panel have flexible axis limits (scales should be free)

```{r}
ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point(aes(color = common_name),
             alpha = 0.6,
             size = 2) +
  theme_dark() +
  facet_wrap(~common_name, scales = "free") +
  labs(x = "Total Length (mm)", 
       y = "Weight (g)",
       title = "Jornada Basin Lizard Sizes",
       subtitle = "All lizards follow the standard lenght-weight relationships, with Western Whiptails being largest",
       caption = "Data: Jornada Basin LTER, CCBY")

#took out shapes because there was only up to 6
```

### Fun with scales


```{r}
ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point(aes(color = weight)) +
  scale_color_gradientn(colors = c("magenta", "cyan4", "darkorchid3", "dodgerblue", "green", "yellow"))
```

```{r}
ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point(aes(color = weight)) +
  scale_color_steps(low = "red", high = "black")

ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point(aes(color = total_length)) +
  scale_color_steps2(low = "purple",
                    mid = "white",
                    high = "orange",
                    midpoint = 150,
                    breaks = c(50, 75, 150, 180, 220, 280))

ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point(aes(color = total_length)) +
  scale_color_stepsn(colors = c("orange", "red", "purple"),
                     breaks = c(50, 55, 80, 140, 200))

ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point(aes(color = total_length)) +
  scale_color_stepsn(colors = c("orange", "red", "purple"),
                     breaks = seq(from = 0,
                                to = 300,
                                by = 60))
```

Make a horizontal boxplot with common name on the y-axis, total length on the x-axis, with boxplot fill changing based on the common name

```{r}
lizards_median <- lizards |> 
  mutate(common_name = fct_reorder(common_name, total_length, .fun = median))

ggplot(data = lizards, aes(x = total_length,
                           y = common_name)) +
  geom_boxplot(aes(fill = common_name))

ggplot(data = lizards_median, aes(y = common_name, x = total_length)) +
  geom_boxplot(aes(fill = common_name), show.legend = FALSE) +
  scale_fill_paletteer_d(palette = "ghibli::SpiritedMedium") +
  theme_minimal()
```

```{r}
ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point(aes(color = weight)) +
  theme(panel.grid.major =  element_line(color = "red"),
        panel.grid.minor.y = element_blank(),
        axis.title.x = element_text(color = "purple", size = 10),
        axis.title.y = element_text(color = "green"),
        text = element_text(size = 18),
        panel.background = element_rect(color = "purple", fill = "yellow")) +
  annotate("text", x = 300, y = 50, label = "WOOOO", color = "blue") +
  geom_vline(xintercept = 250, linetype = "dashed", color = "orange", size = 4)
```

Repulsive labels with `ggrepel`

```{r}
wws_lizards <- lizards |> 
  filter(common_name == "western whiptail",
         site == "sand")

ggplot(data = wws_lizards, aes(x = total_length,
                           y = weight)) +
  geom_point() +
  geom_text_repel(aes(label = toe_num))

gapminder |> 
  filter(year == 2002, continent == "Europe") |> 
  ggplot(aes(x = gdpPercap, y = lifeExp)) +
  geom_point() +
  geom_text_repel(aes(label = country), size = 3)

ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point() +
  gghighlight(toe_num == 250, label_key = toe_num)

ggplot(data = lizards, aes(x = total_length,
                           y = weight)) +
  geom_point() +
  gghighlight(weight > 30, label_key = toe_num)
```

###Make a map!

```{r}
jornada_veg <- read_sf(here("data_raw", "spatial_vegetation", "doc.kml"))

ggplot() + 
  geom_sf(data = jornada_veg, aes(fill = Name)) + 
  theme_minimal() +
  scale_fill_paletteer_d(palette = "ggthemes::manyeys")
```

